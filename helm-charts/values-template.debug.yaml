---
# Source: helm-charts/templates/serviceaccount.yaml
apiVersion: v1
kind: ServiceAccount
metadata:
  name: helm-charts
  labels:
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
automountServiceAccountToken: true
---
# Source: helm-charts/templates/backend-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: helm-charts-backend
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-backend
    # app.kubernetes.io/component: backend
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 3000 # TODO define as a variable
      targetPort: 3000 # TODO define as a variable
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts-backend
---
# Source: helm-charts/templates/database-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: helm-charts-database
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-database
    # app.kubernetes.io/component: database
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: ClusterIP
  ports:
    - port: 3306 # TODO define as a variable
      targetPort: 3306 # TODO define as a variable
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts-database
---
# Source: helm-charts/templates/frontend-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: helm-charts-frontend
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-frontend
    # app.kubernetes.io/component: frontend
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  type: NodePort
  ports:
    - port: 80 # TODO define as a variable
      targetPort: 80 # TODO define as a variable
      protocol: TCP
      name: http
  selector:
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts-frontend
---
# Source: helm-charts/templates/backend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: helm-charts-backend
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-backend
    # app.kubernetes.io/component: backend
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: helm-charts
      app.kubernetes.io/instance: helm-charts-backend
  template:
    metadata:
      labels:
        app.kubernetes.io/name: helm-charts
        app.kubernetes.io/instance: helm-charts-backend
    spec:
      serviceAccountName: helm-charts
      securityContext:
        {}
      containers:
        - name: helm-charts-backend
          securityContext:
            {}
          image: "backend-local:latest"
          imagePullPolicy: Never
          ports:
          - name: http
            containerPort: 3000
            protocol: TCP
          env:
          - name: NODE_ENV
            value: development
          - name: HOST
            value: 0.0.0.0
          - name: PORT
            value: "3000"
            # value:
          - name: DB_HOST
            value: database
          - name: DB_PORT
            value: "3306"
            # value:
          # - name: MARIADB_USER
          #   value:
          - name: MARIADB_PASSWORD
            value: root
          - name: MARIADB_DATABASE
            value: contactsdatabase
          - name: MARIADB_ROOT_PASSWORD
            value: root
          livenessProbe:
            initialDelaySeconds: 10
            periodSeconds: 5
            httpGet:
              path: /
              port: 3000 # TODO define as a variable
          readinessProbe:
            initialDelaySeconds: 20
            periodSeconds: 10
            httpGet:
              path: /
              port: 3000 # TODO define as a variable
          resources:
            {}
---
# Source: helm-charts/templates/database-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: helm-charts-database
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-database
    # app.kubernetes.io/component: database
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: helm-charts
      app.kubernetes.io/instance: helm-charts-database
  template:
    metadata:
      labels:
        app.kubernetes.io/name: helm-charts
        app.kubernetes.io/instance: helm-charts-database
    spec:
      serviceAccountName: helm-charts
      securityContext:
        {}
      containers:
        - name: helm-charts-database
          securityContext:
            {}
          image: "mariadb:latest"
          imagePullPolicy: IfNotPresent
          ports:
          - name: http
            containerPort: 3306
            protocol: TCP
          env:
          - name: NODE_ENV
            value: development
          - name: HOST
            value: 0.0.0.0
          - name: PORT
            value: "3000"
            # value:
          - name: DB_HOST
            value: database
          - name: DB_PORT
            value: "3306"
            # value:
          # - name: MARIADB_USER
          #   value:
          - name: MARIADB_PASSWORD
            value: root
          - name: MARIADB_DATABASE
            value: contactsdatabase
          - name: MARIADB_ROOT_PASSWORD
            value: root
          livenessProbe:
            initialDelaySeconds: 20
            periodSeconds: 10
            tcpSocket:
              port: 3306 # TODO define as a variable
          readinessProbe:
            initialDelaySeconds: 30
            periodSeconds: 10
            tcpSocket:
              port: 3306 # TODO define as a variable
          resources:
            {}
---
# Source: helm-charts/templates/frontend-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: helm-charts-frontend
  labels:
    # app.kubernetes.io/name: helm-charts
    # app.kubernetes.io/instance: helm-charts-frontend
    # app.kubernetes.io/component: frontend
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
spec:
  replicas: 1
  selector:
    matchLabels:
      app.kubernetes.io/name: helm-charts
      app.kubernetes.io/instance: helm-charts-frontend
  template:
    metadata:
      labels:
        app.kubernetes.io/name: helm-charts
        app.kubernetes.io/instance: helm-charts-frontend
    spec:
      serviceAccountName: helm-charts
      securityContext:
        {}
      containers:
        - name: helm-charts-frontend
          securityContext:
            {}
          image: "frontend-local:latest"
          imagePullPolicy: Never
          ports:
          - name: http
            containerPort: 80
            protocol: TCP
          env:
          - name: NODE_ENV
            value: development
          livenessProbe:
            httpGet:
              path: /
              port: 80 # TODO define as a variable
          readinessProbe:
            httpGet:
              path: /
              port: 80 # TODO define as a variable
          resources:
            {}
---
# Source: helm-charts/templates/tests/test-connection.yaml
apiVersion: v1
kind: Pod
metadata:
  name: "helm-charts-test-connection"
  labels:
    helm.sh/chart: helm-charts-0.1.0
    app.kubernetes.io/name: helm-charts
    app.kubernetes.io/instance: helm-charts
    app.kubernetes.io/version: "1.16.0"
    app.kubernetes.io/managed-by: Helm
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: wget
      image: busybox
      command: ["wget"]
      args: ["helm-charts:80"]
  restartPolicy: Never